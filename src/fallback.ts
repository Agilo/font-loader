import AbstractFont from './abstract';

class FontFallback extends AbstractFont {
  styleElement: HTMLStyleElement | undefined;

  public check() {
    if (this.testElement && this.testElement.clientWidth === 0) {
      return true;
    }

    return false;
  }

  public getStyleContent() {
    return `
@font-face {
  font-family: ${this.options.fontFamily};
  font-weight: ${this.options.fontWeight};
  font-style: ${this.options.fontStyle};
  src: url(data:application/font-woff2;charset=utf-8;base64,d09GMgABAAAAAAKYAA8AAAAABngAAAI+AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP0ZGVE0cGiAGYACCUggEEQgKZHoBNgIkAxgLDgAEIAWEKgdEP3dlYmYGG3kFyJ6aPCEiIEEEAGCCM5SI6PdD9977AYYCalTAFkiYToWtr6qOjHCJMSUUHkgR/XTv3v2xGhhfvtcGDTCxDBcHFJb/49ppMMxuwDX5o8T/QOBXSRUaHT6CPdg6bCbT6XRqG8YuLuMpBB4f3nwGeH17Muu+1DOE0ItxgCKiRTSxZ6j55S5aU27lInAGysl1kN20kaAvPn8hFQQPvPKnfP7P/fq23DgPzdU0T+dHziIlnkrZD7Tr7xTM8678//OnWHX0FkgrRG0ps283u0kq7Y83QO1CuQL5b+VVraAbZ+4INasc3rs/xWkoJKIlVMlaKiD5RsfGm/l7F+/thdu2Yt+h7bYGPh3cam35BEItbo+aRbYEt9ta0V80RjyOEIZ//f1Gn+Nr+9zZS/dtZOTmZGe5g9ONEm5KKF9Q0ipfhNYsyAE5R1HWNARre1lZEMExsz+pxyZSGh5iEISuopdVQVTrMBqLImhxxwytBv3QjwiDAdJwuE8WGR7QRIGHuDTER4QMbnxWk1nxwnaGxo4WumA0ByMaKho9ZJeSNuUF2XkpW3ToYxxmPy0Z2tmbWlvBvQYy8qlKu4m1g36dyAmmZV0qFr3Sbqlrblg+a0RlYapHBwhjyMTAjH5ZQwMLCCoJSkjLSApKKcy8DZNZNtQzGp07RAqOhj1mDvVhuv71Wt1no7fNhjyPlmmGuUMba7sVW0O9VeZtHU3tRh2/+DHaak+1koJIqJZDMeOb181E6+zTscdbU53xuB/QxUuNLw==) format("woff2"),url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAR0AA8AAAAABngAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABWAAAABwAAAAcdTvKhkdERUYAAAF0AAAAHQAAACAAMwAET1MvMgAAAZQAAAA9AAAAYFtafodjbWFwAAAB1AAAAEsAAAFSAFos9GN2dCAAAAIgAAAABAAAAAQAIQJ5Z2FzcAAAAiQAAAAIAAAACP//AANnbHlmAAACLAAAAFwAAABkPabHPmhlYWQAAAKIAAAALgAAADYJWl5LaGhlYQAAArgAAAAeAAAAJATiAQFobXR4AAAC2AAAABcAAAAYBK0AIWxvY2EAAALwAAAADgAAAA4AhgB+bWF4cAAAAwAAAAAfAAAAIABKADluYW1lAAADIAAAAR8AAAIqBjFWKHBvc3QAAARAAAAAKwAAAERSq/xAd2ViZgAABGwAAAAGAAAABlznWFkAAAABAAAAAMw9os8AAAAA1H8aUQAAAADUfw1leNpjYGRgYOADYgkGEGBiYARCViBmAfMYAASBADgAAAB42mNgZvzCOIGBlYGFqYspgoGBwRtCM8YBsQ4DKmBE5vj5+7kyODAoqP5hevefjeEE8wsMNQoMjAAQ0AqyAAAAeNpjYGBgZoBgGQZGBhDwAfIYwXwWBgMgzQGETEBagcFR9c///wjW/8f/D9/ihOoCA0Y2BjiXEaSHiQEVMEKswgtYGIY0AADMzwxzAAAhAnkAAAAB//8AAnjaY2BiUGRgYNRimsXAzMDOoLeRkUHfZhM7C8Nbo41srHdsNjEzAZkMG5lBwqwg4U3sbIx/bDYxgsSNBRUF1Y0FlRUZOV8cP84062+aIlME0DgGJGDIAAA4XxTceNpjYGRgYABilV9/38Tz23xlkGd+ARRhuFLPm4ZMM2oxzQJSHAxMIB4ATU4KEAAAeNpjYGRgYHr3n43hBOMXBiBg1GJgZEAFbABsOAPmAAB42mPMYVBkAAJGXwY4YPzCwAAAFAwB0gAAAAAqACoAKgAqACoAMgAAeNpjYGRgYGBj4GBgYgABEMnIABJzYNADCQAABLcAhAB42m2PzS4DURiGn9NWUxINFl1YTawsaGaon+iqCWJBNdrUxkYZlCpGuQiX4Wr8XIH7cAHemX6ZaMnJd/J8P+f93gNM80oWl5vEMQfGGYrKhpxlEc84xwJ7xhO8cG2c1/S38QwZlzeepegKxm+UXMn4Hd8tGX9QcCfGn0y58yF/ZZl3fWraHRFyyRM9TsVHI5lPWRGfKnUOFTuiGstjr/7qeGNKbWURj3S5o6/ub+UGzbRS5UoTA86SuWfVg6ReZlOnyq3UbqQVz1yo2pNihxXRmmKdChuai3U9tuW2rdiX8wYHojqtf92P5sfKOlKPHQxSBy31w0Q1lDtPO/2kF7DFqt0VqwdyErsMuZdKZL/eTRWbPEitq068ufcDNERJbgB42mNgYsAP2BgYGJkYmRmYGVQYWdjScyoLMgwhlBF7aV6mkambMwBY+gc2AAABWFlc5gAA) format("woff"),url(data:font/truetype;charset=utf-8;base64,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) format("truetype");
}
`;
  }

  public addStyle() {
    if (this.styleElement) {
      return;
    }

    const styleContent = this.getStyleContent().trim();

    if (!styleContent || !styleContent.length) {
      return;
    }

    this.styleElement = document.createElement('style');

    this.styleElement.innerHTML = styleContent;
    document.head.appendChild(this.styleElement);
  }

  public load() {
    if (!this.promise) {
      this.promise = Promise.resolve()
        .then(() => this.addStyle())
        .then(() => super.load());
    }

    return this.promise;
  }
}

export default FontFallback;
